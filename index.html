<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í—Ö–æ–¥ —á–µ—Ä–µ–∑ Telegram</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            background: #f5f7fa;
        }
        .card {
            background: white;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            text-align: center;
            max-width: 90%;
            width: 350px;
        }
        h2 { color: #333; margin-bottom: 24px; }
        #status { margin-top: 20px; min-height: 24px; }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
    </style>
</head>
<body>

<div class="card">
    <h2>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
    <!-- Telegram Login Widget -->
    <script 
        async 
        src="https://telegram.org/js/telegram-widget.js?22" 
        data-telegram-login="8290560968:AAHUEueckfcUGDwBzJOxZ6RuMGD0xnWIv5o" 
        data-size="large" 
        data-auth-url="https://ivankedrovskij7-jpg.github.io/FillInTown/" 
        data-request-access="write">
    </script>
    <div id="status"></div>
</div>

<script>
    // Telegram –≤—ã–∑–æ–≤–µ—Ç —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞
    function onTelegramAuth(user) {
        document.getElementById('status').innerHTML = 
            `<span class="success">‚úÖ –ü—Ä–∏–≤–µ—Ç, ${user.first_name}!</span><br>
             ID: ${user.id}<br>
             Username: @${user.username || '‚Äî'}`;
        
        // –û—Ç–ø—Ä–∞–≤–∏–º –¥–∞–Ω–Ω—ã–µ –≤ Supabase —á–µ—Ä–µ–∑ fetch (–±–µ–∑ –±—ç–∫–µ–Ω–¥–∞!)
        sendDataToSupabase(user);
    }

    async function sendDataToSupabase(user) {
        const SUPABASE_URL = 'https://YOUR_PROJECT.supabase.co';
        const SUPABASE_KEY = 'YOUR_ANON_KEY'; // anon, –Ω–µ service!

        try {
            const res = await fetch(`${SUPABASE_URL}/rest/v1/users`, {
                method: 'POST',
                headers: {
                    'apikey': SUPABASE_KEY,
                    'Content-Type': 'application/json',
                    'Prefer': 'return=minimal'
                },
                body: JSON.stringify({
                    telegram_id: user.id,
                    first_name: user.first_name,
                    last_name: user.last_name || null,
                    username: user.username || null,
                    auth_date: user.auth_date
                })
            });

            if (res.ok) {
                document.getElementById('status').innerHTML += `<br><span class="success">üíæ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!</span>`;
            } else {
                throw new Error(await res.text());
            }
        } catch (e) {
            console.error(e);
            document.getElementById('status').innerHTML += 
                `<br><span class="error">‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏</span>`;
        }
    }
</script>

</body>
</html>
